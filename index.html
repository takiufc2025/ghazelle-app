<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHAZELLE COLLECTION | ØºØ²Ø§Ù„</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #003366;
            --accent: #3b82f6;
            --success: #10b981;
            --white: rgba(255, 255, 255, 0.98);
            --light-bg: #f1f5f9;
        }
        body, html { margin: 0; padding: 0; font-family: 'Cairo', sans-serif; background-color: #000; }
        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: url('https://i.ibb.co/Gf0SMJr2/GHAZELLE-COLLECTION.webp') center/cover no-repeat; z-index: -1; filter: brightness(0.3); }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        #welcome-screen { position: fixed; width: 100%; height: 100vh; background: rgba(0, 20, 40, 0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; z-index: 1000; transition: transform 0.8s ease-in-out; }
        .start-btn { padding: 15px 45px; background: var(--accent); color: white; border: none; border-radius: 50px; font-size: 1.4rem; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4); }

        /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .main-container { max-width: 500px; margin: 20px auto; padding: 25px; background: var(--white); border-radius: 20px; display: none; box-shadow: 0 15px 35px rgba(0,0,0,0.5); }
        .header-form { text-align: center; margin-bottom: 20px; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
        .header-form img { width: 80px; }
        
        .section-title { font-size: 1.1rem; font-weight: 900; color: var(--primary); margin: 20px 0 10px; }
        
        /* ÙƒØ§Ø±Øª Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ */
        .model-card { background: var(--light-bg); padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #ddd; }
        .image-display { width: 100%; height: 250px; background: #fff; border-radius: 10px; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 1px solid #eee; }
        .image-display img { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        input, select { padding: 14px; border: 2px solid #cbd5e1; border-radius: 12px; width: 100%; font-family: 'Cairo'; font-size: 1rem; box-sizing: border-box; }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙˆØµÙŠÙ„ */
        .choice-btn-group { display: flex; gap: 12px; margin: 15px 0; }
        .choice-btn { flex: 1; padding: 18px; border: 2px solid #cbd5e1; border-radius: 15px; text-align: center; cursor: pointer; font-weight: bold; background: #fff; transition: 0.3s; }
        .choice-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .add-more-btn { width: 100%; padding: 12px; background: #e2e8f0; color: var(--primary); border: 2px dashed var(--primary); border-radius: 12px; cursor: pointer; font-weight: bold; margin-bottom: 20px; }
        .submit-btn { width: 100%; padding: 20px; background: var(--success); color: white; border: none; border-radius: 15px; font-size: 1.5rem; font-weight: 900; cursor: pointer; margin-top: 10px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="bg-overlay"></div>

<div id="welcome-screen">
    <img src="https://i.ibb.co/Gf0SMJr2/GHAZELLE-COLLECTION.webp" style="width:140px; margin-bottom:20px;">
    <h1 style="text-align: center;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ GHAZELLE COLLECTION</h1>
    <button class="start-btn" onclick="openApp()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
</div>

<div class="main-container" id="app-form">
    <div id="form-content">
        <div class="header-form">
            <img src="https://i.ibb.co/Gf0SMJr2/GHAZELLE-COLLECTION.webp">
            <h2>Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
        </div>

        <form id="orderForm">
            <div class="section-title">ğŸ‘¤ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</div>
            <div class="input-row">
                <input type="text" name="firstname" placeholder="Ø§Ù„Ø§Ø³Ù…" required>
                <input type="text" name="familyname" placeholder="Ø§Ù„Ù„Ù‚Ø¨" required>
            </div>
            <input type="tel" name="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>

            <div class="section-title">ğŸ‘— Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ§Ø±</div>
            
            <div class="model-card">
                <div id="display1" class="image-display"><p style="color:#999">ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</p></div>
                <select name="model1" id="model1" onchange="updateImage(this, 'display1')" required>
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ --</option>
                    <option value="Noor">ğŸ‘— Ù…ÙˆØ¯ÙŠÙ„ Ù†ÙˆØ± - Noor</option>
                    <option value="Ghazelle">ğŸ€ Ù…ÙˆØ¯ÙŠÙ„ ØºØ²Ø§Ù„Ø© - Ghazelle</option>
                    <option value="Miral">â­ Ù…ÙˆØ¯ÙŠÙ„ Ù…ÙŠØ±Ø§Ù„ - Miral</option>
                    <option value="Hiba">ğŸŒ¹ Ù…ÙˆØ¯ÙŠÙ„ Ù‡Ø¨Ø© - Hiba</option>
                    <option value="Rihanna">ğŸŒŸ Ù…ÙˆØ¯ÙŠÙ„ Ø±ÙŠØ§Ù†Ø§ - Rihanna</option>
                    <option value="Rahaf">ğŸƒ Ù…ÙˆØ¯ÙŠÙ„ Ø±Ù‡Ù - Rahaf</option>
                </select>
                <div class="input-row" style="margin-top:10px">
                    <select name="color1" required>
                        <option value="">ğŸ¨ Ø§Ù„Ù„ÙˆÙ†</option>
                        <option value="Ø£Ø­Ù…Ø±">Ø£Ø­Ù…Ø±</option><option value="Ø£Ø³ÙˆØ¯">Ø£Ø³ÙˆØ¯</option><option value="Ø£Ø²Ø±Ù‚">Ø£Ø²Ø±Ù‚</option><option value="Ø£Ø®Ø¶Ø±">Ø£Ø®Ø¶Ø±</option><option value="Ø¨ÙŠØ¬">Ø¨ÙŠØ¬</option>
                    </select>
                    <select name="size1" required>
                        <option value="">ğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³</option>
                        <option value="36">36</option><option value="38">38</option><option value="40">40</option><option value="42">42</option><option value="44">44</option>
                    </select>
                </div>
            </div>

            <button type="button" id="addMoreBtn" class="add-more-btn" onclick="showSecondModel()">+ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„ Ø¢Ø®Ø± (Ø¹Ø±Ø¶ Ø®Ø§Øµ)</button>

            <div id="secondModelArea" class="model-card hidden">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px">
                    <span style="font-weight:bold; color:var(--primary)">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ:</span>
                    <button type="button" onclick="hideSecondModel()" style="color:red; border:none; background:none; cursor:pointer">Ø­Ø°Ù âœ–</button>
                </div>
                <div id="display2" class="image-display"><p style="color:#999">ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ</p></div>
                <select name="model2" id="model2" onchange="updateImage(this, 'display2')">
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ --</option>
                    <option value="Noor">ğŸ‘— Ù†ÙˆØ±</option><option value="Ghazelle">ğŸ€ ØºØ²Ø§Ù„Ø©</option><option value="Rihanna">ğŸŒŸ Ø±ÙŠØ§Ù†Ø§</option>
                </select>
                <div class="input-row" style="margin-top:10px">
                    <select name="color2">
                        <option value="">ğŸ¨ Ø§Ù„Ù„ÙˆÙ†</option>
                        <option value="Ø£Ø­Ù…Ø±">Ø£Ø­Ù…Ø±</option><option value="Ø£Ø³ÙˆØ¯">Ø£Ø³ÙˆØ¯</option>
                    </select>
                    <select name="size2">
                        <option value="">ğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³</option>
                        <option value="38">38</option><option value="40">40</option>
                    </select>
                </div>
            </div>

            <div class="section-title">ğŸšš Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù† (Yalidine)</div>
            <div class="choice-btn-group">
                <div class="choice-btn" id="homeBtn" onclick="setDelivery('adomicile')">ğŸ  ØªÙˆØµÙŠÙ„ Ù„Ù„Ù…Ù†Ø²Ù„</div>
                <div class="choice-btn" id="deskBtn" onclick="setDelivery('stop desk')">ğŸ¢ Ù…ÙƒØªØ¨ ÙŠØ§Ù„ÙŠØ¯ÙŠÙ†</div>
            </div>
            <input type="hidden" name="delivery_type" id="delivery_type" required>

            <div id="locationFields" class="hidden">
                <select name="wilaya" id="wilaya" onchange="initCommunes()" required>
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© --</option>
                </select>
                <select name="commune" id="commune" style="margin-top:10px" onchange="initOffices()" required>
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© --</option>
                </select>
                <div id="officeDiv" class="hidden">
                    <select id="office" style="margin-top:10px" onchange="setOfficeId()"></select>
                </div>
            </div>

            <button type="submit" class="submit-btn" id="subBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
        </form>
    </div>

    <div id="success-box" class="hidden" style="text-align:center; padding:40px">
        <h2 style="color:var(--success)">âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ!</h2>
        <p>Ø³Ù†ØªØµÙ„ Ø¨Ùƒ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ù‚Ø§Ø³.</p>
        <button class="start-btn" onclick="location.reload()" style="font-size:1rem;">ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
    </div>
</div>

<script>
    let yalidineData = [];
    const modelImages = {
        "Noor": "https://i.ibb.co/sJwGWZ44/NOOR.jpg",
        "Rihanna": "https://i.ibb.co/9mt8RZL2/IMG-20250720-202052-133.webp",
        "Ghazelle": "https://i.ibb.co/LXbPT7qB/GHAZELLE-BLAC.jpg",
        "Miral": "https://i.ibb.co/fz608WG7/MIRAL-PERLE.jpg",
        "Hiba": "https://i.ibb.co/FbmcMJvt/RAHAF-VERT-DEAU.jpg",
        "DEFAULT": "https://i.ibb.co/Gf0SMJr2/GHAZELLE-COLLECTION.webp"
    };

    function openApp() {
        document.getElementById('welcome-screen').style.transform = 'translateY(-100%)';
        setTimeout(() => { document.getElementById('app-form').style.display = 'block'; }, 600);
    }

    function updateImage(select, displayId) {
        const display = document.getElementById(displayId);
        if(select.value) {
            display.innerHTML = `<img src="${modelImages[select.value] || modelImages.DEFAULT}">`;
        } else {
            display.innerHTML = `<p style="color:#999">ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</p>`;
        }
    }

    function showSecondModel() {
        document.getElementById('secondModelArea').classList.remove('hidden');
        document.getElementById('addMoreBtn').classList.add('hidden');
    }

    function hideSecondModel() {
        document.getElementById('secondModelArea').classList.add('hidden');
        document.getElementById('addMoreBtn').classList.remove('hidden');
        document.getElementById('model2').value = "";
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± (Sheet API)
    window.onload = async () => {
        try {
            const res = await fetch('/api/yalidine-data');
            yalidineData = await res.json();
        } catch (e) { console.error("Error loading Yalidine data", e); }
    };

    function setDelivery(type) {
        document.getElementById('delivery_type').value = type;
        document.getElementById('homeBtn').classList.toggle('active', type === 'adomicile');
        document.getElementById('deskBtn').classList.toggle('active', type === 'stop desk');
        document.getElementById('locationFields').classList.remove('hidden');
        
        const wSelect = document.getElementById('wilaya');
        wSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© --</option>';
        [...new Set(yalidineData.map(r => r[1]))].sort().forEach(w => wSelect.add(new Option(w, w)));
    }

    function initCommunes() {
        const type = document.getElementById('delivery_type').value;
        const w = document.getElementById('wilaya').value;
        const cSelect = document.getElementById('commune');
        cSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© --</option>';
        let filtered = yalidineData.filter(r => r[1] === w);
        if(type === "stop desk") filtered = filtered.filter(r => r[3].toLowerCase().includes("agence"));
        [...new Set(filtered.map(r => r[2]))].sort().forEach(c => cSelect.add(new Option(c, c)));
    }

    function initOffices() {
        const type = document.getElementById('delivery_type').value;
        const w = document.getElementById('wilaya').value;
        const c = document.getElementById('commune').value;
        const oSelect = document.getElementById('office');
        const oDiv = document.getElementById('officeDiv');
        if (type === "stop desk" && c) {
            oSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙƒØªØ¨ --</option>';
            const offices = yalidineData.filter(r => r[1] === w && r[2] === c && r[3].toLowerCase().includes("agence"));
            if(offices.length > 0) {
                oDiv.classList.remove('hidden');
                offices.forEach(r => {
                    let opt = new Option(r[3], r[3]);
                    opt.dataset.id = r[0];
                    oSelect.add(opt);
                });
            }
        } else { oDiv.classList.add('hidden'); }
    }

    function setOfficeId() {
        const oSelect = document.getElementById('office');
        document.getElementById('stopdesk_id').value = oSelect.options[oSelect.selectedIndex].dataset.id || "";
    }

    document.getElementById('orderForm').onsubmit = async function(e) {
        e.preventDefault();
        const btn = document.getElementById('subBtn');
        btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

        let desc = `1: ${this.model1.value}-${this.color1.value}-${this.size1.value}`;
        if(this.model2.value) desc += ` | 2: ${this.model2.value}-${this.color2.value}-${this.size2.value}`;

        const payload = {
            firstname: this.firstname.value,
            familyname: this.familyname.value,
            phone: this.phone.value,
            delivery_type: this.delivery_type.value,
            wilaya: this.wilaya.value,
            commune: this.commune.value,
            description: desc,
            stopdesk_id: document.getElementById('stopdesk_id')?.value || ""
        };

        try {
            const res = await fetch('/api/orders', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (res.ok) {
                document.getElementById('form-content').classList.add('hidden');
                document.getElementById('success-box').classList.remove('hidden');
            }
        } catch (err) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±"); }
        btn.disabled = false; btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†";
    };
</script>

<input type="hidden" id="stopdesk_id">
</body>
</html>
