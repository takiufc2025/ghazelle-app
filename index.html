<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHAZELLE COLLECTION - ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #002b5c; --accent: #3b82f6; --success: #10b981; }
        body { font-family: 'Cairo', sans-serif; background-color: #f1f5f9; margin: 0; padding: 10px; direction: rtl; }
        .container { max-width: 500px; margin: auto; background: white; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; }
        .header { text-align: center; padding: 20px; border-bottom: 2px solid var(--primary); background: #fff; }
        .header img { width: 100px; }
        .form-body { padding: 20px; }
        
        .section-title { color: var(--primary); font-weight: 900; margin: 20px 0 10px; display: flex; align-items: center; gap: 8px; }
        .model-card { background: #f8fafc; padding: 15px; border-radius: 15px; border: 1px solid #e2e8f0; margin-bottom: 20px; position: relative; }
        .remove-btn { position: absolute; top: 10px; left: 10px; color: #ef4444; cursor: pointer; font-weight: bold; font-size: 0.9rem; }
        
        .img-preview { width: 100%; height: 220px; background: white; border-radius: 12px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; border: 1px solid #eee; overflow: hidden; }
        .img-preview img { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        input, select { width: 100%; padding: 14px; border: 2px solid #cbd5e1; border-radius: 12px; font-family: 'Cairo'; font-size: 1rem; box-sizing: border-box; margin-bottom: 10px; outline: none; transition: 0.3s; }
        input:focus, select:focus { border-color: var(--accent); }
        .row { display: flex; gap: 10px; }
        
        .delivery-btn { flex: 1; padding: 15px; border: 2px solid #cbd5e1; border-radius: 12px; text-align: center; cursor: pointer; font-weight: bold; background: white; transition: 0.3s; }
        .delivery-btn.active { border-color: var(--accent); background: #eff6ff; color: var(--accent); box-shadow: 0 0 10px rgba(59,130,246,0.1); }
        
        .allowed-badge { background: #fff3cd; color: #856404; padding: 12px; border-radius: 12px; font-size: 0.95rem; text-align: center; margin: 15px 0; border: 1px dashed #ffeeba; font-weight: bold; }
        
        .add-more-btn { width: 100%; padding: 15px; border: 2px dashed var(--primary); border-radius: 12px; background: #f1f5f9; color: var(--primary); font-weight: bold; cursor: pointer; margin-bottom: 20px; font-size: 1rem; }
        .submit-btn { width: 100%; padding: 20px; background: var(--success); color: white; border: none; border-radius: 15px; font-size: 1.5rem; font-weight: 900; cursor: pointer; box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3); }
        .hidden { display: none !important; }
        .custom-input { border-color: var(--accent) !important; background: #f0f7ff !important; margin-top: -5px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="https://i.ibb.co/Gf0SMJr2/GHAZELLE-COLLECTION.webp" alt="Ghazelle Logo">
        <h2>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</h2>
    </div>

    <form class="form-body" id="orderForm">
        <div class="section-title">ğŸ‘¤ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</div>
        <div class="row">
            <input type="text" id="fname" placeholder="Ø§Ù„Ø§Ø³Ù…" required>
            <input type="text" id="lname" placeholder="Ø§Ù„Ù„Ù‚Ø¨" required>
        </div>
        <input type="tel" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>

        <div class="section-title">ğŸ‘— Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</div>
        <div id="modelsContainer">
            </div>

        <button type="button" class="add-more-btn" onclick="addModelCard()">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„ Ø¢Ø®Ø± Ù„Ù„Ø·Ù„Ø¨ÙŠØ©</button>

        <div class="section-title">ğŸšš Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</div>
        <div class="allowed-badge">ğŸ“¢ Ù…Ù„Ø§Ø­Ø¸Ø©: Ù…Ø³Ù…ÙˆØ­ Ø¨ÙØªØ­ Ø§Ù„Ø·Ø±Ø¯ ÙˆÙ…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø³Ù„Ø¹Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¯ÙØ¹</div>
        
        <div class="row" style="margin-bottom:15px">
            <div class="delivery-btn" id="btnHome" onclick="setDeliv('home')">ğŸ  Ù„Ù„Ù…Ù†Ø²Ù„</div>
            <div class="delivery-btn" id="btnDesk" onclick="setDeliv('desk')">ğŸ¢ Ø§Ù„Ù…ÙƒØªØ¨</div>
        </div>
        <input type="hidden" id="del_type" required>

        <div id="geoArea" class="hidden">
            <select id="wilaya" onchange="loadCommunes()" required>
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© --</option>
            </select>
            <select id="commune" required>
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© --</option>
            </select>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
    </form>
</div>

<script>
    let modelCount = 0;
    let yalidineData = [];

    // Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
    const colors = ["Ø£Ø³ÙˆØ¯", "Ø£Ø¨ÙŠØ¶", "Ø£Ø­Ù…Ø±", "Ø£Ø²Ø±Ù‚ Ù…Ù„ÙƒÙŠ", "Ø£Ø²Ø±Ù‚ Ø³Ù…Ø§ÙˆÙŠ", "Ø£Ø®Ø¶Ø± ØºØ§Ù…Ù‚", "Ø£Ø®Ø¶Ø± ÙØ§ØªØ­", "ÙˆØ±Ø¯ÙŠ", "Ø¨Ù†ÙØ³Ø¬ÙŠ", "Ø±Ù…Ø§Ø¯ÙŠ", "Ø¨Ù†ÙŠ", "Ø¨ÙŠØ¬", "ÙƒØ±ÙŠÙ…ÙŠ", "Ø®Ø±Ø¯Ù„ÙŠ", "Ù„ÙˆÙ† Ø¢Ø®Ø± (Ø§ÙƒØªØ¨Ù‡)"];
    const sizes = ["36", "38", "40", "42", "44", "46", "48", "Ù…Ù‚Ø§Ø³ Ø¢Ø®Ø± (Ø§ÙƒØªØ¨Ù‡)"];
    const models = {
        "Noor": "https://i.ibb.co/sJwGWZ44/NOOR.jpg",
        "Ghazelle": "https://i.ibb.co/LXbPT7qB/GHAZELLE-BLAC.jpg",
        "Miral": "https://i.ibb.co/fz608WG7/MIRAL-PERLE.jpg",
        "Rihanna": "https://i.ibb.co/9mt8RZL2/IMG-20250720-202052-133.webp",
        "Hiba": "https://i.ibb.co/FbmcMJvt/RAHAF-VERT-DEAU.jpg"
    };

    // ÙˆØ¸ÙŠÙØ© Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø© Ù…ÙˆØ¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯Ø©
    function addModelCard() {
        modelCount++;
        const card = document.createElement('div');
        card.className = 'model-card';
        card.id = `card_${modelCount}`;
        card.innerHTML = `
            ${modelCount > 1 ? `<span class="remove-btn" onclick="removeModel(${modelCount})">Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ âœ–</span>` : ''}
            <div class="img-preview" id="prev_${modelCount}"><p style="color:#94a3b8">ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ§Ø±</p></div>
            
            <select class="model-select" onchange="updateImg(this, ${modelCount})" required>
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ --</option>
                ${Object.keys(models).map(m => `<option value="${m}">${m}</option>`).join('')}
            </select>

            <div class="row">
                <div style="flex:1">
                    <select class="color-select" onchange="toggleCustom(this, 'cCol_${modelCount}')" required>
                        <option value="">ğŸ¨ Ø§Ù„Ù„ÙˆÙ†</option>
                        ${colors.map(c => `<option value="${c}">${c}</option>`).join('')}
                    </select>
                    <input type="text" id="cCol_${modelCount}" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù„ÙˆÙ† Ù‡Ù†Ø§" class="hidden custom-input">
                </div>
                <div style="flex:1">
                    <select class="size-select" onchange="toggleCustom(this, 'cSiz_${modelCount}')" required>
                        <option value="">ğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³</option>
                        ${sizes.map(s => `<option value="${s}">${s}</option>`).join('')}
                    </select>
                    <input type="text" id="cSiz_${modelCount}" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‚Ø§Ø³" class="hidden custom-input">
                </div>
            </div>
        `;
        document.getElementById('modelsContainer').appendChild(card);
    }

    function removeModel(id) { document.getElementById(`card_${id}`).remove(); }

    function updateImg(sel, id) {
        const p = document.getElementById(`prev_${id}`);
        p.innerHTML = sel.value ? `<img src="${models[sel.value]}">` : `<p>ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</p>`;
    }

    function toggleCustom(sel, inputId) {
        const input = document.getElementById(inputId);
        if(sel.value.includes("Ø§ÙƒØªØ¨Ù‡")) {
            input.classList.remove('hidden');
            input.required = true;
        } else {
            input.classList.add('hidden');
            input.required = false;
        }
    }

    // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ§Ù„ÙŠØ¯ÙŠÙ†
    window.onload = async () => {
        addModelCard();
        try {
            const res = await fetch('/api/yalidine-data'); // Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ API Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
            yalidineData = await res.json();
        } catch(e) { console.error("Data Load Error"); }
    };

    function setDeliv(type) {
        document.getElementById('del_type').value = type;
        document.getElementById('btnHome').classList.toggle('active', type==='home');
        document.getElementById('btnDesk').classList.toggle('active', type==='desk');
        document.getElementById('geoArea').classList.remove('hidden');
        
        const wSelect = document.getElementById('wilaya');
        wSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© --</option>';
        [...new Set(yalidineData.map(r => r[1]))].sort().forEach(w => wSelect.add(new Option(w, w)));
    }

    function loadCommunes() {
        const w = document.getElementById('wilaya').value;
        const cSelect = document.getElementById('commune');
        cSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© --</option>';
        yalidineData.filter(r => r[1] === w).forEach(r => cSelect.add(new Option(r[2], r[2])));
    }

    document.getElementById('orderForm').onsubmit = async function(e) {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

        // ØªØ¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
        let details = [];
        document.querySelectorAll('.model-card').forEach((card, index) => {
            const model = card.querySelector('.model-select').value;
            let color = card.querySelector('.color-select').value;
            let size = card.querySelector('.size-select').value;
            
            if(color.includes("Ø§ÙƒØªØ¨Ù‡")) color = card.querySelector('.custom-input[id^="cCol"]').value;
            if(size.includes("Ø§ÙƒØªØ¨Ù‡")) size = card.querySelector('.custom-input[id^="cSiz"]').value;
            
            details.push(`[${model} | ${color} | ${size}]`);
        });

        const payload = {
            firstname: document.getElementById('fname').value,
            familyname: document.getElementById('lname').value,
            phone: document.getElementById('phone').value,
            delivery_type: document.getElementById('del_type').value,
            wilaya: document.getElementById('wilaya').value,
            commune: document.getElementById('commune').value,
            description: details.join(" + ")
        };

        console.log("Sending Data:", payload);
        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ÙŠØªÙƒ Ø¨Ù†Ø¬Ø§Ø­! Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒÙ….");
        btn.disabled = false;
        btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†";
    };
</script>

</body>
</html>
