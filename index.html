<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHAZELLE COLLECTION | Ø²Ù„ÙŠØ¬ Ø¹ØµØ±ÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #003366; /* Ù„ÙˆÙ† Ø£Ø²Ø±Ù‚ Ø¯Ø§ÙƒÙ† Ù…Ø³ØªÙˆØ­Ù‰ Ù…Ù† Ø§Ù„Ø²Ù„ÙŠØ¬ */
            --accent: #3b82f6; /* Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­ Ù…Ø¨Ù‡Ø¬ */
            --success: #10b981; /* Ø£Ø®Ø¶Ø± Ù„Ù„Ù†Ø¬Ø§Ø­ */
            --white: rgba(255, 255, 255, 0.96); /* Ø£Ø¨ÙŠØ¶ Ø´Ø¨Ù‡ Ø´ÙØ§Ù Ù„Ù„Ø®Ù„ÙÙŠØ© */
            --light-bg: #f8fafc; /* Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© Ù„Ù„Ø¹Ù†Ø§ØµØ± */
        }
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Cairo', sans-serif;
            height: 100%;
            width: 100%;
            overflow-x: hidden; /* Ù„Ù…Ù†Ø¹ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ */
        }
        
        /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ø²Ø®Ø±ÙØ© Ø§Ù„Ø²Ù„ÙŠØ¬ */
        .bg-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://output.googleusercontent.com/static/image_generation_content/0/generated_image.webp') center/cover no-repeat;
            z-index: -1;
            filter: brightness(0.7); /* Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø£ØºÙ…Ù‚ Ù‚Ù„ÙŠÙ„Ø§Ù‹ ÙˆØ§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
        #welcome-screen {
            position: fixed; width: 100%; height: 100vh;
            background: rgba(0, 20, 40, 0.88); /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© Ø¬Ø¯Ø§Ù‹ */
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            color: white; z-index: 1000;
            transition: transform 0.8s ease-in-out; /* Ø­Ø±ÙƒØ© Ø§Ù†ØªÙ‚Ø§Ù„ÙŠØ© Ù†Ø§Ø¹Ù…Ø© */
        }

        .welcome-logo {
            width: 120px; /* Ø­Ø¬Ù… Ø£ÙƒØ¨Ø± Ù„Ù„Ø´Ø¹Ø§Ø± ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ */
            height: auto;
            margin-bottom: 25px;
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .start-btn {
            padding: 18px 50px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 50px; /* Ø²Ø± Ø¯Ø§Ø¦Ø±ÙŠ Ø§Ù„Ø´ÙƒÙ„ */
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.4);
            transition: all 0.3s ease;
        }
        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5);
        }

        /* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ù†Ù…ÙˆØ°Ø¬ */
        .main-container {
            max-width: 500px;
            margin: 40px auto;
            padding: 30px;
            background: var(--white);
            border-radius: 25px;
            display: none; /* Ù…Ø®ÙÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: slideUp 0.6s ease; /* Ø­Ø±ÙƒØ© Ø¸Ù‡ÙˆØ± Ù†Ø§Ø¹Ù…Ø© */
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header-form {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 15px;
        }
        .header-form img {
            width: 80px;
            height: auto;
            margin-bottom: 10px;
        }
        .header-form h2 {
            color: var(--primary);
            font-size: 1.8rem;
            margin: 0;
            line-height: 1.2;
        }
        .header-form p {
            color: #666;
            font-size: 0.9rem;
            margin: 5px 0 0;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #e0e0e0;
        }

        .input-row {
            display: flex;
            gap: 12px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø­Ù‚ÙˆÙ„ */
            margin-bottom: 15px;
        }
        .input-row > * { flex: 1; } /* Ù„Ø¬Ø¹Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ ØªØªÙˆØ²Ø¹ Ø¨Ø§Ù„ØªØ³Ø§ÙˆÙŠ */

        input, select {
            padding: 15px;
            border: 2px solid #cbd5e1;
            border-radius: 12px;
            width: 100%;
            font-family: inherit;
            font-size: 1rem;
            box-sizing: border-box; /* Ù„ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ø­Ø´ÙˆØ© ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯ Ø¶Ù…Ù† Ø§Ù„Ø¹Ø±Ø¶ */
            transition: border-color 0.3s ease;
        }
        input:focus, select:focus {
            border-color: var(--accent);
            outline: none;
        }

        .custom-input {
            margin-top: 10px;
            border-color: var(--accent);
            background: var(--light-bg);
        }

        .choice-btn-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            margin-bottom: 25px;
        }
        .choice-btn {
            flex: 1;
            padding: 18px;
            border: 2px solid #cbd5e1;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            background: var(--light-bg);
            color: var(--primary);
            transition: all 0.3s ease;
        }
        .choice-btn:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }
        .choice-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 5px 15px rgba(0, 51, 102, 0.3);
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 25px;
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
            transition: all 0.3s ease;
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        .hidden { display: none !important; }

        .success-box {
            text-align: center;
            padding: 40px;
            display: none; /* Ù…Ø®ÙÙŠØ© ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
            animation: fadeIn 0.8s ease-out;
        }
        .success-box .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: bounce 0.8s infinite alternate;
        }
        @keyframes bounce { 0% { transform: translateY(0); } 100% { transform: translateY(-10px); } }
        .success-box h3 {
            color: var(--success);
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .success-box p {
            color: #555;
            font-size: 1.1rem;
        }

        /* Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ÙØªØ­ Ø§Ù„Ø·Ø±Ø¯ */
        .allow-box {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            margin-bottom: 20px;
            padding: 12px 15px;
            background: var(--light-bg);
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .allow-box:hover {
            border-color: var(--accent);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .allow-box input[type="checkbox"] {
            width: 20px;
            height: 20px;
            min-width: 20px; /* Ù„Ø¶Ù…Ø§Ù† Ø­Ø¬Ù… Ø«Ø§Ø¨Øª */
            accent-color: var(--success); /* Ù„ÙˆÙ† Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØµØ­ */
            cursor: pointer;
        }
        .allow-box label {
            font-weight: bold;
            color: var(--primary);
            cursor: pointer;
            margin: 0; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
            flex-grow: 1; /* Ù„ØªØ£Ø®Ø° Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ø³Ø§Ø­Ø© */
        }
    </style>
</head>
<body>

<div class="bg-overlay"></div>

<div id="welcome-screen">
    <img src="https://i.ibb.co/Gf0SMJr2/GHAZELLE-COLLECTION.webp" alt="Ghazelle Logo" class="welcome-logo">
    <h1 style="font-size: 2.5rem; margin-bottom: 15px;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… GHAZELLE</h1>
    <p style="margin-bottom: 40px; font-size: 1.1rem; color: rgba(255,255,255,0.8);">ØªØµØ§Ù…ÙŠÙ…Ù†Ø§ ØªØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ø£ØµØ§Ù„Ø© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© ÙˆØ§Ù„Ø¹ØµØ±Ù†Ø© Ø§Ù„Ø±Ø§Ù‚ÙŠØ©</p>
    <button class="start-btn" onclick="openApp()">ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</button>
</div>

<div class="main-container" id="app-form">
    <div id="form-content">
        <div class="header-form">
            <img src="https://i.ibb.co/Gf0SMJr2/GHAZELLE-COLLECTION.webp" alt="Ghazelle Logo">
            <h2>Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø·Ù„Ø¨ÙŠØ© GHAZELLE</h2>
            <p>Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø¯Ù†Ø§Ù‡ Ù„ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨ÙŠØªÙƒ.</p>
        </div>

        <form id="orderForm">
            <div class="section-title">ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†</div>
            <div class="input-row">
                <input type="text" name="firstname" placeholder="Ø§Ù„Ø§Ø³Ù…" required>
                <input type="text" name="familyname" placeholder="Ø§Ù„Ù„Ù‚Ø¨" required>
            </div>
            <input type="tel" name="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" style="margin-bottom:25px;" required>

            <div class="section-title">ğŸ‘— ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</div>
            <div class="input-row">
                <select name="model_select" id="model_select" onchange="toggleCustom(this, 'custom_model_div')" required>
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ --</option>
                    <option value="Noor">Noor</option><option value="Ghazelle">Ghazelle</option><option value="Miral">Miral</option>
                    <option value="Hiba">Hiba</option><option value="Miral perlÃ©">Miral perlÃ©</option><option value="Rihanna">Rihanna</option><option value="Rahaf">Rahaf</option>
                    <option value="OTHER">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯Ø§Ù„ Ø¢Ø®Ø±...</option>
                </select>
                <div id="custom_model_div" class="hidden"><input type="text" id="custom_model" class="custom-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯"></div>
            </div>

            <div class="input-row" style="margin-top: 15px;">
                <select name="color_select" id="color_select" onchange="toggleCustom(this, 'custom_color_div')" required>
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ† --</option>
                    <option value="Rouge - Ø£Ø­Ù…Ø±">Rouge - Ø£Ø­Ù…Ø±</option><option value="Blue - Ø£Ø²Ø±Ù‚">Blue - Ø£Ø²Ø±Ù‚</option><option value="Vert - Ø£Ø®Ø¶Ø±">Vert - Ø£Ø®Ø¶Ø±</option>
                    <option value="Noir - Ø£Ø³ÙˆØ¯">Noir - Ø£Ø³ÙˆØ¯</option><option value="Blanc - Ø£Ø¨ÙŠØ¶">Blanc - Ø£Ø¨ÙŠØ¶</option><option value="Rose - ÙˆØ±Ø¯ÙŠ">Rose - ÙˆØ±Ø¯ÙŠ</option>
                    <option value="Marron - Ø¨Ù†ÙŠ">Marron - Ø¨Ù†ÙŠ</option><option value="Beige - Ø¨ÙŠØ¬">Beige - Ø¨ÙŠØ¬</option><option value="DorÃ© - Ø°Ù‡Ø¨ÙŠ">DorÃ© - Ø°Ù‡Ø¨ÙŠ</option>
                    <option value="ArgentÃ© - ÙØ¶ÙŠ">ArgentÃ© - ÙØ¶ÙŠ</option><option value="Blue clair - Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­">Blue clair - Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­</option><option value="Blue roi - Ø£Ø²Ø±Ù‚ Ù…Ù„ÙƒÙŠ">Blue roi - Ø£Ø²Ø±Ù‚ Ù…Ù„ÙƒÙŠ</option>
                    <option value="Vert foncÃ© - Ø£Ø®Ø¶Ø± ØºØ§Ù…Ù‚">Vert foncÃ© - Ø£Ø®Ø¶Ø± ØºØ§Ù…Ù‚</option><option value="Vert olive - Ø£Ø®Ø¶Ø± Ø²ÙŠØªÙˆÙ†ÙŠ">Vert olive - Ø£Ø®Ø¶Ø± Ø²ÙŠØªÙˆÙ†ÙŠ</option><option value="Vert d'eau - Ø£Ø®Ø¶Ø± Ù…Ø§Ø¦ÙŠ">Vert d'eau - Ø£Ø®Ø¶Ø± Ù…Ø§Ø¦ÙŠ</option>
                    <option value="Blanc cassÃ© - Ø£Ø¨ÙŠØ¶ ÙƒØ§Ø³ÙŠ">Blanc cassÃ© - Ø£Ø¨ÙŠØ¶ ÙƒØ§Ø³ÙŠ</option><option value="OTHER">Ù„ÙˆÙ† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯...</option>
                </select>
                <div id="custom_color_div" class="hidden"><input type="text" id="custom_color" class="custom-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù„ÙˆÙ† (FR)"></div>
            </div>

            <div class="input-row" style="margin-top: 15px;">
                <select name="size_select" id="size_select" onchange="toggleCustom(this, 'custom_size_div')" required>
                    <option value="">-- Ø§Ù„Ù…Ù‚Ø§Ø³ --</option>
                    <option value="36">36</option><option value="38">38</option><option value="40">40</option><option value="42">42</option>
                    <option value="44">44</option><option value="46">46</option><option value="48">48</option>
                    <option value="OTHER">Ø¢Ø®Ø±...</option>
                </select>
                <div id="custom_size_div" class="hidden"><input type="text" id="custom_size" class="custom-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù‚Ø§Ø³"></div>
            </div>

            <div class="allow-box">
                <input type="checkbox" id="allow_opening">
                <label for="allow_opening">âœ… Ù…Ø³Ù…ÙˆØ­ Ø¨ÙØªØ­ Ø§Ù„Ø·Ø±Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</label>
            </div>

            <div class="section-title">ğŸšš Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø­Ù†</div>
            <div class="choice-btn-group">
                <div class="choice-btn" id="homeBtn" onclick="setDelivery('adomicile')">ğŸ <br>ØªÙˆØµÙŠÙ„ Ù…Ù†Ø²Ù„ÙŠ</div>
                <div class="choice-btn" id="deskBtn" onclick="setDelivery('stop desk')">ğŸ¢<br>Ù…ÙƒØªØ¨ ÙŠØ§Ù„ÙŠØ¯ÙŠÙ†</div>
            </div>
            <input type="hidden" name="delivery_type" id="delivery_type" required>

            <div id="locationFields" class="hidden">
                <select name="wilaya" id="wilaya" style="margin-top:15px;" onchange="initCommunes()" required>
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© --</option>
                </select>
                <select name="commune" id="commune" style="margin-top:15px;" onchange="initOffices()" required>
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© --</option>
                </select>
                <div id="officeDiv" class="hidden"><select id="office" style="margin-top:15px;" onchange="setOfficeId()"></select></div>
            </div>
            <input type="hidden" name="stopdesk_id" id="stopdesk_id">

            <button type="submit" class="submit-btn" id="subBtn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</button>
            <div id="msg" style="text-align: center; margin-top: 20px; font-weight: bold; color: var(--success);"></div>
        </form>
    </div>
    <div id="success-box" class="success-box">
        <div class="icon">âœ…</div>
        <h3>Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø«Ù‚ØªÙƒ!</h3>
        <p>ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.</p>
    </div>
</div>

<script>
    let yalidineData = []; // ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø³Ù… Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¹Ø§Ø±Ø¶

    // ÙˆØ¸ÙŠÙØ© Ù„ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¹Ø¯ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
    function openApp() {
        document.getElementById('welcome-screen').style.transform = 'translateY(-100%)';
        setTimeout(() => {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('app-form').style.display = 'block';
        }, 600);
    }

    // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ§Ù„ÙŠØ¯ÙŠÙ† Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.onload = async () => {
        try {
            const response = await fetch('/api/yalidine-data');
            yalidineData = await response.json();
            console.log("Yalidine Data loaded successfully.");
        } catch (e) {
            console.error("Error loading Yalidine data:", e);
        }
    };

    // ÙˆØ¸ÙŠÙØ© Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø®ØµØµØ© (Ù…ÙˆØ¯Ø§Ù„ØŒ Ù„ÙˆÙ†ØŒ Ù…Ù‚Ø§Ø³)
    function toggleCustom(select, divId) {
        const div = document.getElementById(divId);
        const input = div.querySelector('input');
        if (select.value === "OTHER") { div.classList.remove('hidden'); input.required = true; }
        else { div.classList.add('hidden'); input.required = false; }
    }

    // ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØµÙŠÙ„ (Ù…Ù†Ø²Ù„ÙŠ Ø£Ùˆ Ù…ÙƒØªØ¨)
    function setDelivery(type) {
        document.getElementById('delivery_type').value = type;
        document.getElementById('homeBtn').classList.toggle('active', type === 'adomicile');
        document.getElementById('deskBtn').classList.toggle('active', type === 'stop desk');
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙˆÙ„Ø§ÙŠØ© ÙˆØ§Ù„Ø¨Ù„Ø¯ÙŠØ©
        document.getElementById('locationFields').classList.remove('hidden');

        // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª
        const wilayaSelect = document.getElementById('wilaya');
        wilayaSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© --</option>';
        if (yalidineData.length > 0) {
            const uniqueWilayas = [...new Set(yalidineData.map(r => r[1]))].sort(); // r[1] Ù‡Ùˆ Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙˆÙ„Ø§ÙŠØ©
            uniqueWilayas.forEach(w => wilayaSelect.add(new Option(w, w)));
        } else {
             // Ø¥Ø¶Ø§ÙØ© ÙˆÙ„Ø§ÙŠØ§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            wilayaSelect.add(new Option('Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±', 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±'));
            wilayaSelect.add(new Option('ÙˆÙ‡Ø±Ø§Ù†', 'ÙˆÙ‡Ø±Ø§Ù†'));
            wilayaSelect.add(new Option('Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©', 'Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©'));
        }
        
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© ÙˆØ§Ù„Ù…ÙƒØªØ¨ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØµÙŠÙ„
        document.getElementById('commune').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© --</option>';
        document.getElementById('officeDiv').classList.add('hidden');
    }

    // ÙˆØ¸ÙŠÙØ© Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù„Ø¯ÙŠØ§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ„Ø§ÙŠØ© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
    function initCommunes() {
        const type = document.getElementById('delivery_type').value;
        const selectedWilaya = document.getElementById('wilaya').value;
        const communeSelect = document.getElementById('commune');
        communeSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© --</option>';
        if(!selectedWilaya) return;
        
        if (yalidineData.length > 0) {
            let filteredCommunes = (type === "stop desk")
                ? [...new Set(yalidineData.filter(r => r[1] === selectedWilaya && r[3].toLowerCase().includes("agence")).map(r => r[2]))].sort() // r[2] Ù‡Ùˆ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©ØŒ r[3] Ù‡Ùˆ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…ÙƒØªØ¨
                : [...new Set(yalidineData.filter(r => r[1] === selectedWilaya).map(r => r[2]))].sort();
            filteredCommunes.forEach(c => communeSelect.add(new Option(c, c)));
        } else {
            // Ø¥Ø¶Ø§ÙØ© Ø¨Ù„Ø¯ÙŠØ§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ØªÙˆÙØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (selectedWilaya === 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±') {
                communeSelect.add(new Option('Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„ÙˆØ³Ø·Ù‰', 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„ÙˆØ³Ø·Ù‰'));
                communeSelect.add(new Option('Ø¨Ø§Ø¨ Ø§Ù„Ø²ÙˆØ§Ø±', 'Ø¨Ø§Ø¨ Ø§Ù„Ø²ÙˆØ§Ø±'));
            }
        }
        document.getElementById('officeDiv').classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙƒØªØ¨ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©
    }

    // ÙˆØ¸ÙŠÙØ© Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙƒØ§ØªØ¨ (Stop Desks) Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†ÙˆØ¹ Ø§Ù„ØªÙˆØµÙŠÙ„ "Ù…ÙƒØªØ¨"
    function initOffices() {
        const type = document.getElementById('delivery_type').value;
        const selectedWilaya = document.getElementById('wilaya').value;
        const selectedCommune = document.getElementById('commune').value;
        const officeSelect = document.getElementById('office');
        const officeDiv = document.getElementById('officeDiv');

        if (type === "stop desk" && selectedCommune && yalidineData.length > 0) {
            officeSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙƒØªØ¨ --</option>';
            const offices = yalidineData.filter(r => r[1] === selectedWilaya && r[2] === selectedCommune && r[3].toLowerCase().includes("agence")); // r[3] Ù‡Ùˆ Ø¹Ù…ÙˆØ¯ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØªØ¨
            if(offices.length > 0) {
                officeDiv.classList.remove('hidden');
                offices.forEach(r => {
                    let opt = new Option(r[3], r[3]); // Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ù‚ÙŠÙ…Ø© Ù‡Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØªØ¨
                    opt.dataset.id = r[0]; // r[0] Ù‡Ùˆ ID Ø§Ù„Ù…ÙƒØªØ¨
                    officeSelect.add(opt);
                });
            } else {
                officeDiv.classList.add('hidden');
            }
        } else {
            officeDiv.classList.add('hidden');
        }
    }

    // ÙˆØ¸ÙŠÙØ© Ù„ØªØ­Ø¯ÙŠØ¯ ID Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ù…Ø®ØªØ§Ø±
    function setOfficeId() {
        const officeSelect = document.getElementById('office');
        document.getElementById('stopdesk_id').value = officeSelect.options[officeSelect.selectedIndex].dataset.id || "";
    }

    // Ù…Ø¹Ø§Ù„Ø¬ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    document.getElementById('orderForm').onsubmit = async function(e) {
        e.preventDefault();
        const submitBtn = document.getElementById('subBtn');
        const msgDiv = document.getElementById('msg');
        submitBtn.disabled = true;
        submitBtn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
        msgDiv.innerText = ""; // Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©

        // Ø¬Ù…Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨ÙŠØ©
        let finalModel = this.model_select.value === "OTHER" ? document.getElementById('custom_model').value : this.model_select.value;
        let finalSize = this.size_select.value === "OTHER" ? document.getElementById('custom_size').value : this.size_select.value;
        let colorVal = this.color_select.value;
        let finalColor = colorVal === "OTHER" ? document.getElementById('custom_color').value : (colorVal.includes(" - ") ? colorVal.split(" - ")[0] : colorVal);

        let descParts = [finalModel.trim(), finalColor.trim(), finalSize.trim()];
        if(document.getElementById('allow_opening').checked) descParts.push("Ù…Ø³Ù…ÙˆØ­ Ø§Ù„ÙØªØ­");
        const finalDesc = descParts.filter(p => p !== "").join(" * ");

        const payload = {
            firstname: this.firstname.value,
            familyname: this.familyname.value,
            phone: this.phone.value,
            delivery_type: this.delivery_type.value,
            wilaya: this.wilaya.value,
            commune: this.commune.value,
            stopdesk_id: this.stopdesk_id.value,
            description: finalDesc
        };

        try {
            const response = await fetch('/api/orders', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (response.ok) {
                document.getElementById('form-content').style.display = 'none';
                document.getElementById('success-box').style.display = 'block';
                this.reset();
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø®ØµØµØ© ÙˆØ­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ø§Ø¬Ø­
                ['custom_model_div', 'custom_color_div', 'custom_size_div', 'locationFields', 'officeDiv'].forEach(id => document.getElementById(id).classList.add('hidden'));
                document.querySelectorAll('.choice-btn').forEach(el => el.classList.remove('active'));
            } else {
                const errorText = await response.text();
                msgDiv.innerText = `Ø­Ø¯Ø« Ø®Ø·Ø£: ${errorText}`;
                msgDiv.style.color = 'red';
            }
        } catch (err) {
            msgDiv.innerText = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.";
            msgDiv.style.color = 'red';
            console.error(err);
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©";
            setTimeout(() => { msgDiv.innerText = ""; }, 5000);
        }
    };
</script>
</body>
</html>
