<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHAZELLE COLLECTION | ØºØ²Ø§Ù„</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #003366;
            --accent: #3b82f6;
            --success: #10b981;
            --white: rgba(255, 255, 255, 0.96);
            --light-bg: #f1f5f9;
        }
        body, html {
            margin: 0; padding: 0;
            font-family: 'Cairo', sans-serif;
            background-color: #000;
        }
        .bg-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://i.ibb.co/Gf0SMJr2/GHAZELLE-COLLECTION.webp') center/cover no-repeat;
            z-index: -1; filter: brightness(0.3);
        }
        #welcome-screen {
            position: fixed; width: 100%; height: 100vh;
            background: rgba(0, 20, 40, 0.9);
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            color: white; z-index: 1000; transition: transform 0.8s ease-in-out;
        }
        .welcome-logo { width: 140px; margin-bottom: 20px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        
        .start-btn {
            padding: 15px 40px; background: var(--accent); color: white;
            border: none; border-radius: 50px; font-size: 1.3rem; font-weight: bold;
            cursor: pointer; box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .main-container {
            max-width: 500px; margin: 20px auto; padding: 25px;
            background: var(--white); border-radius: 20px; display: none;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
        }
        .header-form { text-align: center; margin-bottom: 20px; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
        .header-form img { width: 70px; }
        
        .section-title { font-size: 1.1rem; font-weight: 900; color: var(--primary); margin: 20px 0 10px; }
        
        .model-card {
            background: var(--light-bg); padding: 15px; border-radius: 15px; 
            margin-bottom: 15px; border: 1px solid #ddd;
        }
        .image-display {
            width: 100%; height: 220px; background: #fff; border-radius: 10px;
            margin-bottom: 15px; display: flex; align-items: center; justify-content: center;
            overflow: hidden; border: 1px solid #eee;
        }
        .image-display img { max-width: 100%; max-height: 100%; object-fit: contain; }
        
        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        input, select { padding: 12px; border: 2px solid #cbd5e1; border-radius: 10px; width: 100%; font-family: 'Cairo'; font-size: 1rem; }
        
        .add-more-btn {
            width: 100%; padding: 12px; background: var(--primary); color: white;
            border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-bottom: 20px;
        }

        .choice-btn-group { display: flex; gap: 10px; margin: 15px 0; }
        .choice-btn {
            flex: 1; padding: 12px; border: 2px solid #cbd5e1; border-radius: 12px;
            text-align: center; cursor: pointer; font-weight: bold; background: #fff;
        }
        .choice-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .submit-btn {
            width: 100%; padding: 18px; background: var(--success); color: white;
            border: none; border-radius: 12px; font-size: 1.4rem; font-weight: 900; cursor: pointer;
        }
        .hidden { display: none !important; }
        .allow-box { display: flex; align-items: center; gap: 10px; margin: 15px 0; font-weight: bold; color: var(--primary); }
    </style>
</head>
<body>

<div class="bg-overlay"></div>

<div id="welcome-screen">
    <img src="https://i.ibb.co/Gf0SMJr2/GHAZELLE-COLLECTION.webp" class="welcome-logo">
    <h1 style="text-align: center; padding: 0 20px;">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ GHAZELLE COLLECTION</h1>
    <p>Ø£Ø±Ù‚Ù‰ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© Ø§Ù„Ø¹ØµØ±ÙŠØ©</p>
    <button class="start-btn" onclick="openApp()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
</div>

<div class="main-container" id="app-form">
    <div id="form-content">
        <div class="header-form">
            <img src="https://i.ibb.co/Gf0SMJr2/GHAZELLE-COLLECTION.webp">
            <h2>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ÙŠØ©</h2>
        </div>

        <form id="orderForm">
            <div class="section-title">ğŸ‘¤ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</div>
            <div class="input-row">
                <input type="text" name="firstname" placeholder="Ø§Ù„Ø§Ø³Ù…" required>
                <input type="text" name="familyname" placeholder="Ø§Ù„Ù„Ù‚Ø¨" required>
            </div>
            <input type="tel" name="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø¶Ø±ÙˆØ±ÙŠ)" required>

            <div class="section-title">ğŸ‘— ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª</div>
            
            <div class="model-card">
                <div id="display1" class="image-display"><p style="color:#999">ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ§Ø±</p></div>
                <select name="model1" id="model1" onchange="updateImage(this, 'display1')" required>
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ --</option>
                    <option value="Noor">ğŸ‘— Ù…ÙˆØ¯ÙŠÙ„ Ù†ÙˆØ± - Noor</option>
                    <option value="Ghazelle">ğŸ€ Ù…ÙˆØ¯ÙŠÙ„ ØºØ²Ø§Ù„Ø© - Ghazelle</option>
                    <option value="Miral">â­ Ù…ÙˆØ¯ÙŠÙ„ Ù…ÙŠØ±Ø§Ù„ - Miral</option>
                    <option value="Hiba">ğŸŒ¹ Ù…ÙˆØ¯ÙŠÙ„ Ù‡Ø¨Ø© - Hiba</option>
                    <option value="Miral perlÃ©">ğŸ’ Ù…ÙŠØ±Ø§Ù„ Ø¨ÙŠØ±Ù„ÙŠ - Miral perlÃ©</option>
                    <option value="Rihanna">ğŸŒŸ Ù…ÙˆØ¯ÙŠÙ„ Ø±ÙŠØ§Ù†Ø§ - Rihanna</option>
                    <option value="Rahaf">ğŸƒ Ù…ÙˆØ¯ÙŠÙ„ Ø±Ù‡Ù - Rahaf</option>
                    <option value="OTHER">â• Ù…ÙˆØ¯ÙŠÙ„ Ø¢Ø®Ø±...</option>
                </select>
                <div class="input-row" style="margin-top:10px">
                    <select name="color1" required>
                        <option value="">ğŸ¨ Ø§Ù„Ù„ÙˆÙ†</option>
                        <option value="Rouge - Ø£Ø­Ù…Ø±">Rouge - Ø£Ø­Ù…Ø±</option><option value="Noir - Ø£Ø³ÙˆØ¯">Noir - Ø£Ø³ÙˆØ¯</option>
                        <option value="Vert - Ø£Ø®Ø¶Ø±">Vert - Ø£Ø®Ø¶Ø±</option><option value="Bleu - Ø£Ø²Ø±Ù‚">Bleu - Ø£Ø²Ø±Ù‚</option>
                        <option value="Blanc - Ø£Ø¨ÙŠØ¶">Blanc - Ø£Ø¨ÙŠØ¶</option><option value="Rose - ÙˆØ±Ø¯ÙŠ">Rose - ÙˆØ±Ø¯ÙŠ</option>
                        <option value="Beige - Ø¨ÙŠØ¬">Beige - Ø¨ÙŠØ¬</option><option value="Marron - Ø¨Ù†ÙŠ">Marron - Ø¨Ù†ÙŠ</option>
                    </select>
                    <select name="size1" required>
                        <option value="">ğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³</option>
                        <option value="36">36</option><option value="38">38</option><option value="40">40</option>
                        <option value="42">42</option><option value="44">44</option><option value="46">46</option>
                    </select>
                </div>
            </div>

            <button type="button" id="addMoreBtn" class="add-more-btn" onclick="showSecondModel()">+ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„ Ø¢Ø®Ø± Ù„Ù„Ø·Ù„Ø¨ÙŠØ©</button>

            <div id="secondModelArea" class="model-card hidden">
                <div style="display:flex; justify-content:space-between; margin-bottom:10px">
                    <span style="font-weight:bold; color:var(--primary)">Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ:</span>
                    <button type="button" onclick="hideSecondModel()" style="color:red; border:none; cursor:pointer">Ø¥Ù„ØºØ§Ø¡ âœ–</button>
                </div>
                <div id="display2" class="image-display"><p style="color:#999">ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ 2</p></div>
                <select name="model2" id="model2" onchange="updateImage(this, 'display2')">
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ --</option>
                    <option value="Noor">ğŸ‘— Ù…ÙˆØ¯ÙŠÙ„ Ù†ÙˆØ± - Noor</option>
                    <option value="Ghazelle">ğŸ€ Ù…ÙˆØ¯ÙŠÙ„ ØºØ²Ø§Ù„Ø© - Ghazelle</option>
                    <option value="Miral">â­ Ù…ÙˆØ¯ÙŠÙ„ Ù…ÙŠØ±Ø§Ù„ - Miral</option>
                    <option value="Hiba">ğŸŒ¹ Ù…ÙˆØ¯ÙŠÙ„ Ù‡Ø¨Ø© - Hiba</option>
                    <option value="Rihanna">ğŸŒŸ Ù…ÙˆØ¯ÙŠÙ„ Ø±ÙŠØ§Ù†Ø§ - Rihanna</option>
                </select>
                <div class="input-row" style="margin-top:10px">
                    <select name="color2">
                        <option value="">ğŸ¨ Ø§Ù„Ù„ÙˆÙ†</option>
                        <option value="Rouge - Ø£Ø­Ù…Ø±">Rouge - Ø£Ø­Ù…Ø±</option><option value="Noir - Ø£Ø³ÙˆØ¯">Noir - Ø£Ø³ÙˆØ¯</option>
                        <option value="Vert - Ø£Ø®Ø¶Ø±">Vert - Ø£Ø®Ø¶Ø±</option><option value="Bleu - Ø£Ø²Ø±Ù‚">Bleu - Ø£Ø²Ø±Ù‚</option>
                    </select>
                    <select name="size2">
                        <option value="">ğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³</option>
                        <option value="36">36</option><option value="38">38</option><option value="40">40</option>
                    </select>
                </div>
            </div>

            <div class="allow-box">
                <input type="checkbox" id="allow_opening" checked>
                <label for="allow_opening">âœ… Ù…Ø³Ù…ÙˆØ­ Ø¨ÙØªØ­ Ø§Ù„Ø·Ø±Ø¯ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</label>
            </div>

            <div class="section-title">ğŸšš Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</div>
            <div class="choice-btn-group">
                <div class="choice-btn" id="homeBtn" onclick="setDelivery('adomicile')">ğŸ  Ù„Ù„Ø¨ÙŠØª</div>
                <div class="choice-btn" id="deskBtn" onclick="setDelivery('stop desk')">ğŸ¢ Ù…ÙƒØªØ¨ ÙŠØ§Ù„ÙŠØ¯ÙŠÙ†</div>
            </div>
            <input type="hidden" name="delivery_type" id="delivery_type" required>

            <div id="locationFields" class="hidden">
                <select name="wilaya" id="wilaya" onchange="initCommunes()" required>
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© --</option>
                </select>
                <select name="commune" id="commune" style="margin-top:10px" onchange="initOffices()" required>
                    <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© --</option>
                </select>
                <div id="officeDiv" class="hidden"><select id="office" style="margin-top:10px" onchange="setOfficeId()"></select></div>
            </div>

            <button type="submit" class="submit-btn" id="subBtn" style="margin-top:20px">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
            <div id="msg" style="text-align:center; margin-top:10px"></div>
        </form>
    </div>

    <div id="success-box" class="hidden" style="text-align:center; padding:30px">
        <h2 style="color:var(--success)">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­! âœ…</h2>
        <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒ ÙÙŠ GHAZELLE COLLECTION. Ø³Ù†ØªØµÙ„ Ø¨Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù„ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨ÙŠØªÙƒ.</p>
        <button class="start-btn" onclick="location.reload()" style="margin-top:20px">Ø·Ù„Ø¨ Ù…ÙˆØ¯ÙŠÙ„ Ø¢Ø®Ø±</button>
    </div>
</div>

<script>
    let yalidineData = [];
    const modelImages = {
        "Noor": "https://i.ibb.co/sJwGWZ44/NOOR.jpg",
        "Rihanna": "https://i.ibb.co/9mt8RZL2/IMG-20250720-202052-133.webp",
        "Ghazelle": "<img src="https://i.ibb.co/LXbPT7qB/GHAZELLE-BLAC.jpg",
        "Miral": "https://i.ibb.co/fz608WG7/MIRAL-PERLE.jpg",
        "Hiba": "https://i.ibb.co/FbmcMJvt/RAHAF-VERT-DEAU.jpg",
        "DEFAULT": "https://i.ibb.co/Gf0SMJr2/GHAZELLE-COLLECTION.webp"
    };

    function openApp() {
        document.getElementById('welcome-screen').style.transform = 'translateY(-100%)';
        setTimeout(() => { document.getElementById('app-form').style.display = 'block'; }, 600);
    }

    function updateImage(select, displayId) {
        const display = document.getElementById(displayId);
        const model = select.value;
        if(model) {
            const url = modelImages[model] || modelImages["DEFAULT"];
            display.innerHTML = `<img src="${url}">`;
        } else {
            display.innerHTML = `<p style="color:#999">ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</p>`;
        }
    }

    function showSecondModel() {
        document.getElementById('secondModelArea').classList.remove('hidden');
        document.getElementById('addMoreBtn').classList.add('hidden');
    }

    function hideSecondModel() {
        document.getElementById('secondModelArea').classList.add('hidden');
        document.getElementById('addMoreBtn').classList.remove('hidden');
        document.getElementById('model2').value = "";
    }

    window.onload = async () => {
        try {
            const res = await fetch('/api/yalidine-data');
            yalidineData = await res.json();
        } catch (e) { console.error("Data error", e); }
    };

    function setDelivery(type) {
        document.getElementById('delivery_type').value = type;
        document.getElementById('homeBtn').classList.toggle('active', type === 'adomicile');
        document.getElementById('deskBtn').classList.toggle('active', type === 'stop desk');
        document.getElementById('locationFields').classList.remove('hidden');
        
        const wSelect = document.getElementById('wilaya');
        wSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ© --</option>';
        [...new Set(yalidineData.map(r => r[1]))].sort().forEach(w => wSelect.add(new Option(w, w)));
    }

    function initCommunes() {
        const type = document.getElementById('delivery_type').value;
        const w = document.getElementById('wilaya').value;
        const cSelect = document.getElementById('commune');
        cSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© --</option>';
        let filtered = yalidineData.filter(r => r[1] === w);
        if(type === "stop desk") filtered = filtered.filter(r => r[3].toLowerCase().includes("agence"));
        [...new Set(filtered.map(r => r[2]))].sort().forEach(c => cSelect.add(new Option(c, c)));
    }

    function initOffices() {
        const type = document.getElementById('delivery_type').value;
        const w = document.getElementById('wilaya').value;
        const c = document.getElementById('commune').value;
        const oSelect = document.getElementById('office');
        const oDiv = document.getElementById('officeDiv');
        if (type === "stop desk" && c) {
            oSelect.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙƒØªØ¨ --</option>';
            const offices = yalidineData.filter(r => r[1] === w && r[2] === c && r[3].toLowerCase().includes("agence"));
            if(offices.length > 0) {
                oDiv.classList.remove('hidden');
                offices.forEach(r => {
                    let opt = new Option(r[3], r[3]);
                    opt.dataset.id = r[0];
                    oSelect.add(opt);
                });
            }
        } else { oDiv.classList.add('hidden'); }
    }

    function setOfficeId() {
        const oSelect = document.getElementById('office');
        document.getElementById('stopdesk_id').value = oSelect.options[oSelect.selectedIndex].dataset.id || "";
    }

    document.getElementById('orderForm').onsubmit = async function(e) {
        e.preventDefault();
        const btn = document.getElementById('subBtn');
        btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

        let finalDesc = `Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ 1: ${this.model1.value} (${this.color1.value}, ${this.size1.value})`;
        if(this.model2.value) {
            finalDesc += ` | Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ 2: ${this.model2.value} (${this.color2.value}, ${this.size2.value})`;
        }
        if(document.getElementById('allow_opening').checked) finalDesc += " [Ù…Ø³Ù…ÙˆØ­ Ø¨ÙØªØ­ Ø§Ù„Ø·Ø±Ø¯]";

        const payload = {
            firstname: this.firstname.value,
            familyname: this.familyname.value,
            phone: this.phone.value,
            delivery_type: this.delivery_type.value,
            wilaya: this.wilaya.value,
            commune: this.commune.value,
            description: finalDesc,
            stopdesk_id: document.getElementById('stopdesk_id')?.value || ""
        };

        try {
            const res = await fetch('/api/orders', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (res.ok) {
                document.getElementById('form-content').classList.add('hidden');
                document.getElementById('success-box').classList.remove('hidden');
            }
        } catch (err) { alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±"); }
        btn.disabled = false; btn.innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨";
    };
</script>

<input type="hidden" id="stopdesk_id">
</body>
</html>

